# Diagrama de Flujo OAuth Microsoft - ZENTRIA AFE

## Vista General del Sistema

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ZENTRIA AFE - Sistema OAuth                          â”‚
â”‚                     AutenticaciÃ³n Corporativa Enterprise                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Frontend   â”‚          â”‚   Backend    â”‚          â”‚  Microsoft   â”‚
â”‚ afe_frontend â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ afe-backend  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  Azure AD    â”‚
â”‚ React + TS   â”‚   API    â”‚   FastAPI    â”‚   OAuth  â”‚   Identity   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Flujo Completo de AutenticaciÃ³n OAuth

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Usuario â”‚                                                        â”‚Microsoft â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                                                        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚                                                                  â”‚
     â”‚  1. Click "Continuar con Microsoft"                              â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º                        â”‚
     â”‚                                        â”‚                        â”‚
     â”‚                                   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”                  â”‚
     â”‚                                   â”‚LoginPage â”‚                  â”‚
     â”‚                                   â”‚  .tsx    â”‚                  â”‚
     â”‚                                   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                  â”‚
     â”‚                                        â”‚                        â”‚
     â”‚                                        â”‚ 2. microsoftAuthServiceâ”‚
     â”‚                                        â”‚    .loginWithMicrosoft()â”‚
     â”‚                                        â”‚                        â”‚
     â”‚                                   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”                  â”‚
     â”‚                                   â”‚ Backend  â”‚                  â”‚
     â”‚                                   â”‚GET /auth/â”‚                  â”‚
     â”‚                                   â”‚microsoft/â”‚                  â”‚
     â”‚                                   â”‚authorize â”‚                  â”‚
     â”‚                                   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                  â”‚
     â”‚                                        â”‚                        â”‚
     â”‚                                        â”‚ 3. Genera URL + state  â”‚
     â”‚                                        â”‚                        â”‚
     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
     â”‚  â”‚ 4. Redirect a Microsoft                                     â”‚
     â”‚  â”‚    https://login.microsoftonline.com/...                    â”‚
     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
     â”‚                                                                  â”‚
     â”‚                                                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
     â”‚                                                       â”‚ Microsoft     â”‚
     â”‚                                                       â”‚ Login Page    â”‚
     â”‚                                                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚  5. Login Form (email/password o SSO)                           â”‚
     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                                                                  â”‚
     â”‚  6. Ingresa credenciales                                        â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
     â”‚                                                                  â”‚
     â”‚                                                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
     â”‚                                                       â”‚ Microsoft     â”‚
     â”‚                                                       â”‚ Consent Page  â”‚
     â”‚                                                       â”‚ (primera vez) â”‚
     â”‚                                                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚  7. Pantalla de permisos                                        â”‚
     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                                                                  â”‚
     â”‚  8. Acepta permisos                                             â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
     â”‚                                                                  â”‚
     â”‚                                                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
     â”‚                                                       â”‚ Microsoft     â”‚
     â”‚                                                       â”‚ Genera cÃ³digo â”‚
     â”‚                                                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚  9. Redirect con code                                           â”‚
     â”‚     http://localhost:3000/auth/microsoft/callback?code=xxx      â”‚
     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                                                                  â”‚
     â”‚                                                                  â”‚
â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  MicrosoftCallbackPage.tsx                                    â”‚     â”‚
â”‚  - Extrae code y state de URL                                 â”‚     â”‚
â”‚  - Valida state (CSRF protection)                             â”‚     â”‚
â”‚  - Loading UI                                                 â”‚     â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
     â”‚                                                                  â”‚
     â”‚  10. microsoftAuthService.handleCallback(code, state)           â”‚
     â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º                    â”‚
     â”‚                                           â”‚                     â”‚
     â”‚                                      â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”               â”‚
     â”‚                                      â”‚ Backend  â”‚               â”‚
     â”‚                                      â”‚GET /auth/â”‚               â”‚
     â”‚                                      â”‚microsoft/â”‚               â”‚
     â”‚                                      â”‚callback  â”‚               â”‚
     â”‚                                      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜               â”‚
     â”‚                                           â”‚                     â”‚
     â”‚                                           â”‚ 11. Valida code     â”‚
     â”‚                                           â”‚                     â”‚
     â”‚                                      â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
     â”‚                                      â”‚microsoft_oauth   â”‚       â”‚
     â”‚                                      â”‚_service.py       â”‚       â”‚
     â”‚                                      â”‚                  â”‚       â”‚
     â”‚                                      â”‚ get_token_from   â”‚       â”‚
     â”‚                                      â”‚ _code()          â”‚       â”‚
     â”‚                                      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
     â”‚                                           â”‚                     â”‚
     â”‚                                           â”‚ 12. Intercambio     â”‚
     â”‚                                           â”‚     code por token  â”‚
     â”‚                                           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
     â”‚                                           â”‚                     â”‚
     â”‚                                           â”‚ 13. Access Token    â”‚
     â”‚                                           â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                                           â”‚                     â”‚
     â”‚                                      â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
     â”‚                                      â”‚ get_user_info()  â”‚       â”‚
     â”‚                                      â”‚                  â”‚       â”‚
     â”‚                                      â”‚ Microsoft Graph  â”‚       â”‚
     â”‚                                      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
     â”‚                                           â”‚                     â”‚
     â”‚                                           â”‚ 14. GET /me         â”‚
     â”‚                                           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
     â”‚                                           â”‚                     â”‚
     â”‚                                           â”‚ 15. User Info       â”‚
     â”‚                                           â”‚     (email, name,   â”‚
     â”‚                                           â”‚      photo)         â”‚
     â”‚                                           â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                                           â”‚                     â”‚
     â”‚                                      â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
     â”‚                                      â”‚ find_or_create    â”‚      â”‚
     â”‚                                      â”‚ _user()           â”‚      â”‚
     â”‚                                      â”‚                   â”‚      â”‚
     â”‚                                      â”‚ - Busca por email â”‚      â”‚
     â”‚                                      â”‚ - Crea si no hay  â”‚      â”‚
     â”‚                                      â”‚ - Actualiza OAuth â”‚      â”‚
     â”‚                                      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
     â”‚                                           â”‚                     â”‚
     â”‚                                      â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
     â”‚                                      â”‚   PostgreSQL      â”‚      â”‚
     â”‚                                      â”‚                   â”‚      â”‚
     â”‚                                      â”‚ INSERT/UPDATE     â”‚      â”‚
     â”‚                                      â”‚ responsables      â”‚      â”‚
     â”‚                                      â”‚                   â”‚      â”‚
     â”‚                                      â”‚ auth_provider =   â”‚      â”‚
     â”‚                                      â”‚   'microsoft'     â”‚      â”‚
     â”‚                                      â”‚ oauth_id = xxx    â”‚      â”‚
     â”‚                                      â”‚ oauth_picture=... â”‚      â”‚
     â”‚                                      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
     â”‚                                           â”‚                     â”‚
     â”‚                                      â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
     â”‚                                      â”‚ create_access     â”‚      â”‚
     â”‚                                      â”‚ _token()          â”‚      â”‚
     â”‚                                      â”‚                   â”‚      â”‚
     â”‚                                      â”‚ Genera JWT        â”‚      â”‚
     â”‚                                      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
     â”‚                                           â”‚                     â”‚
     â”‚  16. TokenResponse                        â”‚                     â”‚
     â”‚     {access_token, usuario, rol, ...}     â”‚                     â”‚
     â”‚  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
     â”‚                                                                  â”‚
â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  MicrosoftCallbackPage.tsx                                    â”‚     â”‚
â”‚  - Recibe token                                               â”‚     â”‚
â”‚  - dispatch(setCredentials({token, usuario}))                 â”‚     â”‚
â”‚  - Guarda en Redux store                                      â”‚     â”‚
â”‚  - Success UI (2 segundos)                                    â”‚     â”‚
â”‚  - navigate('/dashboard')                                     â”‚     â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
     â”‚                                                                  â”‚
     â”‚  17. Redirect a Dashboard                                       â”‚
     â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º                              â”‚
     â”‚                                  â”‚                              â”‚
     â”‚                             â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”                         â”‚
     â”‚                             â”‚Dashboardâ”‚                         â”‚
     â”‚                             â”‚  Page   â”‚                         â”‚
     â”‚  18. Usuario autenticado    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                    â”‚
     â”‚                                                                  â”‚
â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”                                                            â”‚
â”‚ Usuario â”‚                                                            â”‚
â”‚ Logged  â”‚                                                            â”‚
â”‚   In    â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                            â”‚
```

---

## Arquitectura de Archivos

```
ZENTRIA AFE OAuth System
â”‚
â”œâ”€â”€ Backend (afe-backend)
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ”§ ConfiguraciÃ³n
â”‚   â”‚   â”œâ”€â”€ app/core/config.py ........................ Variables OAuth
â”‚   â”‚   â”œâ”€â”€ .env ...................................... Credenciales Azure
â”‚   â”‚   â””â”€â”€ requirements.txt .......................... authlib, msal
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“Š Base de Datos
â”‚   â”‚   â”œâ”€â”€ app/models/responsable.py ................. Modelo OAuth
â”‚   â”‚   â”‚   â”œâ”€â”€ auth_provider (local/microsoft)
â”‚   â”‚   â”‚   â”œâ”€â”€ oauth_id (unique)
â”‚   â”‚   â”‚   â”œâ”€â”€ oauth_picture
â”‚   â”‚   â”‚   â””â”€â”€ hashed_password (nullable)
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ alembic/versions/
â”‚   â”‚       â””â”€â”€ oauth_support_responsables_clean.py ... MigraciÃ³n
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ” Servicios OAuth
â”‚   â”‚   â””â”€â”€ app/services/microsoft_oauth_service.py
â”‚   â”‚       â”œâ”€â”€ get_authorization_url() ............... Genera URL
â”‚   â”‚       â”œâ”€â”€ get_token_from_code() ................. Intercambio
â”‚   â”‚       â”œâ”€â”€ get_user_info() ....................... Graph API
â”‚   â”‚       â””â”€â”€ find_or_create_user() ................. BD Logic
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸŒ API Endpoints
â”‚   â”‚   â””â”€â”€ app/api/v1/routers/auth.py
â”‚   â”‚       â”œâ”€â”€ GET /auth/microsoft/authorize ......... Inicia OAuth
â”‚   â”‚       â””â”€â”€ GET /auth/microsoft/callback .......... Callback
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ“š DocumentaciÃ³n
â”‚       â”œâ”€â”€ INTEGRACION_OAUTH_MICROSOFT_COMPLETADA.md
â”‚       â”œâ”€â”€ CHECKLIST_ACTIVACION_OAUTH.md
â”‚       â”œâ”€â”€ DIAGRAMA_FLUJO_OAUTH.md (este archivo)
â”‚       â””â”€â”€ docs/
â”‚           â”œâ”€â”€ CONFIGURACION_AZURE_AD_ZENTRIA.md
â”‚           â””â”€â”€ AZURE_AD_OAUTH_SETUP.md
â”‚
â”œâ”€â”€ Frontend (afe_frontend)
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ¨ Componentes UI
â”‚   â”‚   â””â”€â”€ src/features/auth/
â”‚   â”‚       â”œâ”€â”€ LoginPage.tsx ......................... Login Enterprise
â”‚   â”‚       â”‚   â”œâ”€â”€ DiseÃ±o corporativo Fortune 500
â”‚   â”‚       â”‚   â”œâ”€â”€ BotÃ³n Microsoft oficial
â”‚   â”‚       â”‚   â”œâ”€â”€ Badges Enterprise/Secure
â”‚   â”‚       â”‚   â”œâ”€â”€ Animaciones suaves
â”‚   â”‚       â”‚   â””â”€â”€ handleMicrosoftLogin()
â”‚   â”‚       â”‚
â”‚   â”‚       â””â”€â”€ MicrosoftCallbackPage.tsx ............. Callback Handler
â”‚   â”‚           â”œâ”€â”€ Loading state
â”‚   â”‚           â”œâ”€â”€ Success state
â”‚   â”‚           â”œâ”€â”€ Error state
â”‚   â”‚           â””â”€â”€ Auto-redirect
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ”§ Servicios
â”‚   â”‚   â””â”€â”€ src/services/microsoftAuth.service.ts
â”‚   â”‚       â”œâ”€â”€ loginWithMicrosoft() .................. Inicia flujo
â”‚   â”‚       â”œâ”€â”€ handleCallback() ...................... Procesa cÃ³digo
â”‚   â”‚       â””â”€â”€ CSRF validation (state)
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ›£ï¸ Routing
â”‚   â”‚   â””â”€â”€ src/AppRoutes.tsx
â”‚   â”‚       â””â”€â”€ /auth/microsoft/callback .............. Ruta pÃºblica
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ—ƒï¸ State Management
â”‚       â””â”€â”€ src/features/auth/authSlice.ts
â”‚           â””â”€â”€ setCredentials() ...................... Redux action
â”‚
â””â”€â”€ Microsoft Azure
    â”‚
    â””â”€â”€ ğŸ¢ Azure AD (Entra ID)
        â”œâ”€â”€ App Registration
        â”‚   â”œâ”€â”€ ID: 79dc4cdc-137b-415f-8193-a7a5b3fdd47b
        â”‚   â”œâ”€â”€ Tenant: c9ef7bf6-bbe0-4c50-b2e9-ea58d635ca46
        â”‚   â””â”€â”€ Client Secret: M6q8Q~_g4pu...
        â”‚
        â”œâ”€â”€ Authentication
        â”‚   â””â”€â”€ Redirect URIs
        â”‚       â”œâ”€â”€ http://localhost:3000/auth/microsoft/callback
        â”‚       â””â”€â”€ https://afe.zentria.com/auth/microsoft/callback
        â”‚
        â””â”€â”€ API Permissions
            â”œâ”€â”€ User.Read (Microsoft Graph)
            â”œâ”€â”€ email (OpenID)
            â”œâ”€â”€ profile (OpenID)
            â””â”€â”€ openid (OpenID)
```

---

## Flujo de Datos

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Flujo de Datos OAuth                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. INICIO
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Usuario        â”‚
   â”‚ Click botÃ³n    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Frontend       â”‚
   â”‚ sessionStorage â”‚
   â”‚ .setItem(state)â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Backend        â”‚
   â”‚ Genera URL     â”‚
   â”‚ + state random â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼

2. AUTENTICACIÃ“N MICROSOFT
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Microsoft      â”‚
   â”‚ Login Page     â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Microsoft      â”‚
   â”‚ Valida user    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Microsoft      â”‚
   â”‚ Genera code    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼

3. CALLBACK
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Frontend       â”‚
   â”‚ Recibe code    â”‚
   â”‚ Valida state   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Backend        â”‚
   â”‚ Intercambia    â”‚
   â”‚ code x token   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Microsoft      â”‚
   â”‚ Retorna        â”‚
   â”‚ access_token   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼

4. INFORMACIÃ“N USUARIO
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Backend        â”‚
   â”‚ GET /me        â”‚
   â”‚ (Graph API)    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Microsoft      â”‚
   â”‚ Retorna info   â”‚
   â”‚ {id, email...} â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼

5. BASE DE DATOS
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Backend        â”‚
   â”‚ Busca usuario  â”‚
   â”‚ por email      â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Â¿Existe?        â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚ SÃ    â”‚    NO   â”‚
   â–¼       â”‚         â–¼
UPDATE    â”‚     INSERT
oauth_id  â”‚     nuevo
oauth_pic â”‚     usuario
          â”‚
          â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
                â”‚
                â–¼

6. JWT TOKEN
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Backend        â”‚
   â”‚ Genera JWT     â”‚
   â”‚ {sub, id, rol} â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Frontend       â”‚
   â”‚ Redux store    â”‚
   â”‚ setCredentials â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼

7. NAVEGACIÃ“N
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Frontend       â”‚
   â”‚ navigate(      â”‚
   â”‚  '/dashboard') â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Usuario        â”‚
   â”‚ Autenticado    â”‚
   â”‚ âœ… Dashboard   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Seguridad Implementada

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Medidas de Seguridad                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. CSRF Protection
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Frontend genera state aleatorio      â”‚
   â”‚ â”œâ”€ secrets.token_urlsafe(32)        â”‚
   â”‚ â”œâ”€ Guarda en sessionStorage          â”‚
   â”‚ â””â”€ EnvÃ­a a Microsoft                 â”‚
   â”‚                                       â”‚
   â”‚ Microsoft retorna mismo state        â”‚
   â”‚                                       â”‚
   â”‚ Frontend valida                      â”‚
   â”‚ â””â”€ if (stored !== returned) â†’ Error  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

2. HTTPS (ProducciÃ³n)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Redirect URIs solo HTTPS             â”‚
   â”‚ Cookies con flag Secure              â”‚
   â”‚ HSTS headers                         â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

3. Token Validation
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Backend valida token Microsoft       â”‚
   â”‚ â”œâ”€ Firma del token                   â”‚
   â”‚ â”œâ”€ Emisor (Microsoft)                â”‚
   â”‚ â”œâ”€ Audiencia (Client ID)             â”‚
   â”‚ â””â”€ ExpiraciÃ³n                        â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

4. Scopes MÃ­nimos
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Solo permisos necesarios:            â”‚
   â”‚ â”œâ”€ User.Read (info bÃ¡sica)           â”‚
   â”‚ â”œâ”€ email                             â”‚
   â”‚ â””â”€ profile                           â”‚
   â”‚                                       â”‚
   â”‚ NO pedimos:                          â”‚
   â”‚ â”œâ”€ Mail.Read                         â”‚
   â”‚ â”œâ”€ Files.ReadWrite                   â”‚
   â”‚ â””â”€ Otros permisos sensibles          â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

5. Manejo de Errores
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Mensajes genÃ©ricos al usuario        â”‚
   â”‚ Logs detallados en servidor          â”‚
   â”‚ No expone informaciÃ³n sensible       â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

6. Session Management
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ JWT con expiraciÃ³n                   â”‚
   â”‚ Tokens en memoria (Redux)            â”‚
   â”‚ No en localStorage (XSS protection)  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Estados de la AplicaciÃ³n

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Estados del Sistema                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

LoginPage.tsx
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Estado Inicial                  â”‚
â”‚ â”œâ”€ microsoftLoading: false      â”‚
â”‚ â”œâ”€ BotÃ³n enabled                â”‚
â”‚ â””â”€ Formulario visible           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ Click "Continuar con Microsoft"
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Estado Loading                  â”‚
â”‚ â”œâ”€ microsoftLoading: true       â”‚
â”‚ â”œâ”€ BotÃ³n disabled               â”‚
â”‚ â”œâ”€ Spinner visible              â”‚
â”‚ â””â”€ Redirigiendo...              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ window.location.href = auth_url
         â–¼
     Microsoft


MicrosoftCallbackPage.tsx
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Estado Loading                  â”‚
â”‚ â”œâ”€ status: 'loading'            â”‚
â”‚ â”œâ”€ CircularProgress visible     â”‚
â”‚ â”œâ”€ "Completando autenticaciÃ³n"  â”‚
â”‚ â””â”€ useEffect ejecutando         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ handleCallback()
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Â¿Ã‰xito?             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ SÃ       â”‚    NO    â”‚
â–¼          â”‚          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Estado Success                  â”‚  â”‚ Estado Error                    â”‚
â”‚ â”œâ”€ status: 'success'            â”‚  â”‚ â”œâ”€ status: 'error'              â”‚
â”‚ â”œâ”€ CheckCircle verde            â”‚  â”‚ â”œâ”€ ErrorIcon rojo               â”‚
â”‚ â”œâ”€ "Â¡AutenticaciÃ³n exitosa!"    â”‚  â”‚ â”œâ”€ Alert con mensaje            â”‚
â”‚ â”œâ”€ "Redirigiendo..."            â”‚  â”‚ â”œâ”€ BotÃ³n "Reintentar"           â”‚
â”‚ â””â”€ setTimeout â†’ navigate()      â”‚  â”‚ â””â”€ BotÃ³n "Volver al login"     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                                      â”‚
         â”‚ 2 segundos                           â”‚ Click botÃ³n
         â–¼                                      â–¼
    Dashboard                              LoginPage
```

---

## Tipos de Usuarios

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Tipos de Usuarios                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Usuario Tipo 1: Tradicional (Local)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Responsable                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ usuario: "juan.perez"           â”‚
â”‚ email: "juan@zentria.com"       â”‚
â”‚ hashed_password: "bcrypt..."    â”‚
â”‚ auth_provider: "local"          â”‚
â”‚ oauth_id: NULL                  â”‚
â”‚ oauth_picture: NULL             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Login: usuario + contraseÃ±a


Usuario Tipo 2: OAuth (Microsoft)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Responsable                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ usuario: "maria.garcia"         â”‚
â”‚ email: "maria@zentria.com"      â”‚
â”‚ hashed_password: NULL           â”‚
â”‚ auth_provider: "microsoft"      â”‚
â”‚ oauth_id: "e3b0c442..."         â”‚
â”‚ oauth_picture: "https://..."    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Login: BotÃ³n Microsoft


Usuario Tipo 3: HÃ­brido (Vinculado)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Responsable                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ usuario: "carlos.lopez"         â”‚
â”‚ email: "carlos@zentria.com"     â”‚
â”‚ hashed_password: "bcrypt..."    â”‚
â”‚ auth_provider: "microsoft"      â”‚
â”‚ oauth_id: "f7c9d823..."         â”‚
â”‚ oauth_picture: "https://..."    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Login: Microsoft O usuario+password
(Cuenta vinculada - ambos mÃ©todos funcionan)
```

---

## Proceso de VinculaciÃ³n de Cuentas

```
Escenario: Usuario existe con auth local, login con Microsoft por primera vez
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. Estado Inicial
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ BD: Responsable                â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚ email: "user@zentria.com"      â”‚
   â”‚ auth_provider: "local"         â”‚
   â”‚ hashed_password: "..."         â”‚
   â”‚ oauth_id: NULL                 â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

2. Usuario hace login con Microsoft
   â””â”€â–º Microsoft retorna: email="user@zentria.com"

3. Backend ejecuta find_or_create_user()
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Busca por email                â”‚
   â”‚ â””â”€â–º Â¡Existe!                   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

4. Backend actualiza registro
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ UPDATE responsables            â”‚
   â”‚ SET                            â”‚
   â”‚   auth_provider = 'microsoft'  â”‚
   â”‚   oauth_id = '...'             â”‚
   â”‚   oauth_picture = '...'        â”‚
   â”‚ WHERE email = 'user@...'       â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

5. Estado Final
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ BD: Responsable                â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚ email: "user@zentria.com"      â”‚
   â”‚ auth_provider: "microsoft"     â”‚
   â”‚ hashed_password: "..." â† AÃºn   â”‚
   â”‚ oauth_id: "abc123..."          â”‚
   â”‚ oauth_picture: "https://..."   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Resultado: Usuario puede usar AMBOS mÃ©todos de login
- Microsoft OAuth âœ…
- Usuario + Password âœ… (password no se borra)
```

---

## Endpoints del Sistema

```
Backend API Endpoints
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Base URL: http://localhost:8000/api/v1

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ OAuth Endpoints                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ GET  /auth/microsoft/authorize                               â”‚
â”‚      â”œâ”€ Query params: Ninguno                                â”‚
â”‚      â”œâ”€ Response: {authorization_url, state}                 â”‚
â”‚      â””â”€ Uso: Inicia flujo OAuth                              â”‚
â”‚                                                               â”‚
â”‚ GET  /auth/microsoft/callback                                â”‚
â”‚      â”œâ”€ Query params: code, state                            â”‚
â”‚      â”œâ”€ Response: {access_token, token_type, usuario, ...}   â”‚
â”‚      â””â”€ Uso: Completa flujo OAuth                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Auth Endpoints Existentes                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ POST /auth/login                                             â”‚
â”‚      â””â”€ Login tradicional (usuario + password)               â”‚
â”‚                                                               â”‚
â”‚ POST /auth/logout                                            â”‚
â”‚      â””â”€ Cierra sesiÃ³n                                        â”‚
â”‚                                                               â”‚
â”‚ POST /auth/recuperar                                         â”‚
â”‚      â””â”€ RecuperaciÃ³n de contraseÃ±a                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


Frontend Routes
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Base URL: http://localhost:3000

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Public Routes                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ /login                                                       â”‚
â”‚ â””â”€ LoginPage con botÃ³n Microsoft                            â”‚
â”‚                                                               â”‚
â”‚ /auth/microsoft/callback                                     â”‚
â”‚ â””â”€ MicrosoftCallbackPage (procesa OAuth)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Protected Routes (requieren auth)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ /dashboard                                                   â”‚
â”‚ /facturas                                                    â”‚
â”‚ /admin/responsables                                          â”‚
â”‚ /gestion/proveedores                                         â”‚
â”‚ /email-config                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## PrÃ³ximos Pasos de Desarrollo (Opcional)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Roadmap de Mejoras Futuras                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Fase 2: Otros Proveedores OAuth
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â–¡ Google OAuth                  â”‚
â”‚ â–¡ Azure AD B2C                  â”‚
â”‚ â–¡ Okta integration              â”‚
â”‚ â–¡ Generic OIDC provider         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Fase 3: Single Sign-On
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â–¡ Auto-login si sesiÃ³n activa   â”‚
â”‚ â–¡ Logout global (todos devices) â”‚
â”‚ â–¡ Session management UI         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Fase 4: Multi-Factor Auth
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â–¡ Microsoft MFA integration     â”‚
â”‚ â–¡ TOTP for local users          â”‚
â”‚ â–¡ Backup codes                  â”‚
â”‚ â–¡ SMS verification              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Fase 5: GestiÃ³n de Usuarios
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â–¡ Link/unlink providers         â”‚
â”‚ â–¡ Ver sesiones activas          â”‚
â”‚ â–¡ Revocar tokens                â”‚
â”‚ â–¡ Audit log de logins           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Fase 6: Enterprise Features
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â–¡ Domain restrictions           â”‚
â”‚ â–¡ Role mapping from Azure AD    â”‚
â”‚ â–¡ Just-in-time provisioning     â”‚
â”‚ â–¡ SCIM user provisioning        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Testing Checklist

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Testing Checklist                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â–¡ Unit Tests
  â”œâ”€ â–¡ microsoft_oauth_service.py
  â”‚   â”œâ”€ â–¡ get_authorization_url()
  â”‚   â”œâ”€ â–¡ get_token_from_code()
  â”‚   â”œâ”€ â–¡ get_user_info()
  â”‚   â””â”€ â–¡ find_or_create_user()
  â”‚
  â”œâ”€ â–¡ microsoftAuth.service.ts
  â”‚   â”œâ”€ â–¡ loginWithMicrosoft()
  â”‚   â””â”€ â–¡ handleCallback()
  â”‚
  â””â”€ â–¡ auth.py endpoints
      â”œâ”€ â–¡ /microsoft/authorize
      â””â”€ â–¡ /microsoft/callback

â–¡ Integration Tests
  â”œâ”€ â–¡ Flujo OAuth completo
  â”œâ”€ â–¡ VinculaciÃ³n de cuentas
  â”œâ”€ â–¡ Error handling
  â””â”€ â–¡ State validation

â–¡ E2E Tests
  â”œâ”€ â–¡ Login con Microsoft nuevo usuario
  â”œâ”€ â–¡ Login con Microsoft usuario existente
  â”œâ”€ â–¡ Re-login despuÃ©s de logout
  â”œâ”€ â–¡ Error en callback
  â””â”€ â–¡ Cancel en Microsoft login page

â–¡ Security Tests
  â”œâ”€ â–¡ CSRF attack simulation
  â”œâ”€ â–¡ Token expiration
  â”œâ”€ â–¡ Invalid state parameter
  â””â”€ â–¡ Replay attack prevention

â–¡ UX Tests
  â”œâ”€ â–¡ Loading states
  â”œâ”€ â–¡ Error messages
  â”œâ”€ â–¡ Success feedback
  â””â”€ â–¡ Mobile responsive
```

---

## ConclusiÃ³n

Este sistema OAuth implementa autenticaciÃ³n corporativa de clase enterprise con:

âœ… **Seguridad robusta**: CSRF protection, token validation, HTTPS
âœ… **Experiencia premium**: DiseÃ±o Fortune 500, animaciones suaves
âœ… **Escalabilidad**: Arquitectura preparada para mÃºltiples proveedores
âœ… **Flexibilidad**: Soporte dual auth (local + OAuth)
âœ… **Mantenibilidad**: CÃ³digo limpio, documentaciÃ³n completa

**Estado**: ğŸš€ Listo para producciÃ³n
**PrÃ³ximo paso**: Ejecutar migraciÃ³n y configurar Azure Portal

---

Generated: 2025-10-28
System: ZENTRIA AFE - Advanced Financial Engine
