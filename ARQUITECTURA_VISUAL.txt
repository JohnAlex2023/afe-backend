================================================================================
                    AFE BACKEND - ARQUITECTURA COMPLETA
================================================================================

VISTA GENERAL DEL SISTEMA
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

                           FLUJO DE FACTURA (Actual)

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   FACTURA   â”‚ â”€â”€â”€â”€>â”‚  REVISIÃ“N    â”‚ â”€â”€â”€â”€>â”‚  APROBADA    â”‚
    â”‚    LLEGA    â”‚      â”‚   MANUAL     â”‚      â”‚   / AUTO     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â–²                      â”‚
                              â”‚                      â–¼
                              â”‚                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚                 â”‚  RECHAZADA   â”‚
                              â”‚                 â”‚   (Devuelta) â”‚
                              â”‚                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                         Workflow
                         AprobaciÃ³n


                    âŒ FALTA: Â¿QUÃ‰ PASA DESPUÃ‰S?

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  APROBADA    â”‚      â”‚    PAGADA    â”‚ â”€â”€â”€â”€>â”‚  COMPLETADO  â”‚
    â”‚     /AUTO    â”‚ â”€â”€â”€â”€>â”‚   (NUEVA)    â”‚      â”‚  (CICLO 100%)â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          [PagoFactura]


================================================================================
                       ESTRUCTURA DE DATOS (Propuesta)
================================================================================

TABLA: facturas (EXISTE)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id | numero_factura | proveedor_id | estado | total_a_pagar | ...  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â–²                                  â–²
     â”‚                                  â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚ (Foreign Key)
                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TABLA: pagos_facturas (NUEVA)                          â† AQUÃ FALTA â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id | factura_id | numero_pago | monto_pagado | metodo_pago         â”‚
â”‚ estado_pago | fecha_pago | procesado_por | referencia_externa ...   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


TABLA: workflow_aprobacion (EXISTE)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id | factura_id | aprobada_por | fecha_aprobacion | ...              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


TABLA: historial_pagos (EXISTE - para anÃ¡lisis estadÃ­stico)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id | proveedor_id | concepto_normalizado | tipo_patron              â”‚
â”‚ monto_promedio | desviacion_estandar | ...                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


================================================================================
                          ENDPOINTS (Propuesta)
================================================================================

ACTUALES (âœ… FUNCIONAN):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
GET    /api/v1/facturas                           - Listar facturas
GET    /api/v1/facturas/{id}                      - Detalle factura
POST   /api/v1/facturas/{id}/aprobar              - Aprobar manual
POST   /api/v1/facturas/{id}/rechazar             - Rechazar
POST   /api/v1/accounting/facturas/{id}/devolver  - Devolver (nuevo)
GET    /api/v1/accounting/facturas/pendientes     - Pendientes (nuevo)


NUEVOS (âŒ FALTA AGREGAR):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
POST   /api/v1/accounting/facturas/{id}/pagar                â† CRÃTICA
GET    /api/v1/accounting/facturas/{id}/historial-pagos     â† INFORMACIÃ“N
POST   /api/v1/accounting/pagos/{id}/revertir               â† REVERSIÃ“N


PROPUESTOS (Para fase 2):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
GET    /api/v1/reports/tesoreria/resumen          - Dinero en circulaciÃ³n
GET    /api/v1/reports/tesoreria/vencidas         - Facturas vencidas
GET    /api/v1/reports/cash-flow/prediccion       - Forecast 90 dÃ­as
GET    /api/v1/reports/kpi/pagos                  - KPIs de pago


================================================================================
                        FLUJO DE PAGO (Propuesto)
================================================================================

CONTADOR VE DASHBOARD:

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Factura #F001 - $1,000,000    â”‚
    â”‚  Estado: APROBADA              â”‚
    â”‚  Proveedor: ACME Corp          â”‚
    â”‚                                â”‚
    â”‚  [BotÃ³n: Marcar como Pagado]  â”‚ â† NUEVO
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼ (Click)
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ MODAL: REGISTRAR PAGO          â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ Monto: [1000000]               â”‚
    â”‚ MÃ©todo: [Transferencia â–¼]      â”‚
    â”‚ Referencia: [TRF001234]        â”‚
    â”‚ Fecha: [19/11/2025] [14:30]    â”‚
    â”‚                                â”‚
    â”‚ [Cancelar] [Guardar]           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼ (Guardar)
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ POST /accounting/facturas/1    â”‚
    â”‚      /pagar                    â”‚
    â”‚                                â”‚
    â”‚ Validar:                       â”‚
    â”‚ âœ“ Factura aprobada            â”‚
    â”‚ âœ“ Monto â‰¤ pendiente           â”‚
    â”‚ âœ“ Referencia Ãºnica            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼ (OK)
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ GUARDAR PAGO:                  â”‚
    â”‚ - PagoFactura record          â”‚
    â”‚ - Factura.estado = PAGADA     â”‚
    â”‚ - AuditorÃ­a: quiÃ©n, cuÃ¡ndo    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ EMAIL AL PROVEEDOR:            â”‚
    â”‚ "Pago recibido - $1M"         â”‚
    â”‚ "Referencia: TRF001234"       â”‚
    â”‚ "Fecha: 19/11/2025 14:30"     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Factura #F001 - PAGADA âœ“      â”‚
    â”‚  Total Pagado: $1,000,000      â”‚
    â”‚  Pendiente: $0                 â”‚
    â”‚  Fecha Pago: 19/11/2025        â”‚
    â”‚                                â”‚
    â”‚  [Ver Historial de Pagos]      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


================================================================================
                      PROPIEDADES CALCULADAS (Factura)
================================================================================

@property total_pagado
    â†’ Suma de todos los PagoFactura con estado COMPLETADO
    â†’ Ejemplo: $600,000

@property pendiente_pagar
    â†’ total_a_pagar - total_pagado
    â†’ Ejemplo: $1,000,000 - $600,000 = $400,000

@property esta_completamente_pagada
    â†’ pendiente_pagar â‰¤ 0.01 (tolerancia 1 centavo)
    â†’ Si TRUE â†’ estado = PAGADA

@property dias_sin_pagar
    â†’ AHORA - fecha_aprobacion
    â†’ Ejemplo: 5 dÃ­as
    â†’ Usado para alertas: "Vencida en X dÃ­as"

@property requiere_atencion_pago
    â†’ Si estado APROBADA y dias_sin_pagar > 5
    â†’ Alerta para contador


================================================================================
                          AUDITORÃA Y SEGURIDAD
================================================================================

QUIÃ‰N PUEDE HACER QUÃ‰:

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ ROL: RESPONSABLE (Aprobador)                                      â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ âœ“ Ver facturas asignadas                                          â•‘
â•‘ âœ“ Aprobar/Rechazar                                                â•‘
â•‘ âœ— NO ver pagos                                                    â•‘
â•‘ âœ— NO marcar como pagado                                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ ROL: CONTADOR (Contabilidad)                                      â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ âœ“ Ver todas facturas aprobadas                                    â•‘
â•‘ âœ“ Marcar como PAGADA    â† NUEVO                                   â•‘
â•‘ âœ“ Revertir pago         â† NUEVO                                   â•‘
â•‘ âœ“ Ver historial pagos   â† NUEVO                                   â•‘
â•‘ âœ“ Devolver factura (info faltante)                               â•‘
â•‘ âœ— NO aprobar/rechazar (solo marcado manual)                       â•‘
â•‘ âœ— NO editar monto de factura                                     â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ ROL: ADMIN                                                        â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ âœ“ TODO (gestiÃ³n sistema)                                          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


AUDITORÃA (Lo que se registra):

Cuando se MARCA COMO PAGADA:
  âœ“ PagoFactura.procesado_por   = usuario.usuario
  âœ“ PagoFactura.fecha_procesamiento = NOW()
  âœ“ PagoFactura.numero_pago     = PAG-{id}-{timestamp}
  âœ“ PagoFactura.referencia_externa = referencia_banco
  âœ“ Log: "Contador X pagÃ³ factura Y - $Z - ref ABC"

Cuando se REVIERTE:
  âœ“ PagoFactura.revertido_por = usuario.usuario
  âœ“ PagoFactura.fecha_reversion = NOW()
  âœ“ PagoFactura.motivo_reversion = motivo
  âœ“ Factura.estado vuelve a APROBADA
  âœ“ Log: "Pago revertido por contador X - motivo: Y"


================================================================================
                         MÃ‰TRICAS Y REPORTES
================================================================================

DASHBOARD CONTADOR - KPIs:

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ TESORERÃA (Real-time)                                       â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ Total en circulaciÃ³n:        $45,500,000                    â•‘
â•‘   - Aprobadas sin pagar:     $30,000,000                    â•‘
â•‘   - En pago parcial:         $15,500,000                    â•‘
â•‘                                                             â•‘
â•‘ Facturas vencidas:           5  (requieren atenciÃ³n)       â•‘
â•‘ PrÃ³ximas a vencer (7 dÃ­as):  12                            â•‘
â•‘                                                             â•‘
â•‘ Promedio dÃ­as pago:          8.5 dÃ­as                       â•‘
â•‘ % Pagadas a tiempo:          92%                            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

REPORTES DISPONIBLES:

1. CASH FLOW PREDICCIÃ“N (90 dÃ­as)
   - Dinero esperado por ingresar
   - Por fecha
   - Por proveedor

2. FACTURAS VENCIDAS
   - Listado de facturas sin pagar
   - DÃ­as de retraso
   - Contacto proveedor

3. PERFORMANCE CONTADOR
   - Facturas procesadas/dÃ­a
   - % devoluciones
   - Tiempo promedio procesamiento

4. PROVEEDORES TOP 10
   - Montos mayores
   - DÃ­as promedio pago
   - Historial de devoluciones


================================================================================
                      TABLA DE TRANSFORMACIÃ“N
================================================================================

ANTES                          â”‚ DESPUÃ‰S
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Factura en "aprobada"          â”‚ Factura en "aprobada"
    â†“                          â”‚     â†“
Â¿QuiÃ©n la pagÃ³?              â”‚ Contador marca PAGAR
    â†“                          â”‚     â†“
NO HAY FORMA                  â”‚ Modal: monto, fecha, ref
    â†“                          â”‚     â†“
Proveedor no sabe            â”‚ Email automÃ¡tico
    â†“                          â”‚     â†“
No hay visibilidad           â”‚ Factura en "pagada"
    â†“                          â”‚     â†“
No hay reportes              â”‚ Dashboard: pagadas/pendientes
                             â”‚     â†“
                             â”‚ Reportes: tesorerÃ­a, KPIs


================================================================================
                           TIMELINE (Propuesto)
================================================================================

LUNES:
  09:00 - Crear modelo PagoFactura
  11:00 - Crear schemas de validaciÃ³n
  13:00 - BREAK
  14:00 - Crear endpoints POST /pagar, GET /historial
  16:00 - Endpoint DELETE /revertir
  17:00 - Testing bÃ¡sico

MARTES:
  09:00 - Crear template email pago
  10:00 - IntegraciÃ³n con UnifiedEmailService
  12:00 - Testing emails
  13:00 - BREAK
  14:00 - Frontend: Modal de pago
  16:00 - Frontend: Filtro pagadas/pendientes
  17:00 - Testing frontend

MIÃ‰RCOLES:
  09:00 - Tests unitarios (validaciones)
  11:00 - Tests integraciÃ³n (endpoints)
  13:00 - BREAK
  14:00 - Bugfixes encontrados
  16:00 - Code review
  17:00 - DocumentaciÃ³n

JUEVES:
  09:00 - Deploy staging
  11:00 - Testing en vivo
  13:00 - BREAK
  14:00 - Deploy producciÃ³n
  16:00 - Monitoreo
  17:00 - Cierre


VIERNES:
  09:00 - DocumentaciÃ³n final
  11:00 - Meeting con stakeholders
  13:00 - Pausa
  14:00 - Preparar roadmap fase 2
  16:00 - Retrospective


RESULTADO FINAL: Sistema de pagos 100% funcional âœ…


================================================================================
                         VALIDACIONES (CÃ³digo)
================================================================================

ANTES DE GUARDAR PAGO:

if not factura:
    âŒ Factura no existe

if factura.estado not in [APROBADA, APROBADA_AUTO]:
    âŒ Solo se pueden pagar facturas aprobadas

if request.monto_pagado > factura.pendiente_pagar:
    âŒ No puedes pagar mÃ¡s de lo pendiente

if request.monto_pagado <= 0:
    âŒ El monto debe ser positivo

if existe_referencia(request.referencia_externa):
    âŒ Esa referencia ya existe (evita duplicados)

if request.fecha_pago > NOW():
    âŒ No puedes pagar en el futuro


================================================================================
                      ANÃLISIS DE IMPACTO
================================================================================

ROI (Retorno de InversiÃ³n):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Esfuerzo:        5-6 horas
Costo:          ~$500-600 (1 dev * 5-6 horas)
Beneficios:
  - Visibilidad de $$$
  - AuditorÃ­a completa
  - Reportes de tesorerÃ­a
  - Control de pagos
  - Menos errores

Payback:         < 1 semana (por eficiencia mejorada)

Riesgo:          BAJO
  - CÃ³digo simple
  - PatrÃ³n establecido en sistema
  - AuditorÃ­a integrada


================================================================================
                      CONCLUSIÃ“N
================================================================================

Tu sistema tiene las piezas 1-4 del 5 piezas puzzle:
  1. âœ… AutenticaciÃ³n
  2. âœ… AprobaciÃ³n
  3. âœ… AutomatizaciÃ³n
  4. âœ… Devoluciones
  5. âŒ PAGOS â† AquÃ­ estamos

Implementar esto es como poner el Ãºltimo ladrillo en la casa.
5-6 horas de trabajo. Muy alto impacto.

Â¡Adelante! ğŸš€

================================================================================
